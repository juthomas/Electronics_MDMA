#include "../../inc/mdma.h"



uint8_t *feed_one_pixel(uint16_t pixel_index, uint8_t *pixels, uint32_t color)
{
		// ((((color & 0xFF0000) >> (int32_t)16) * percentage / 100) << (int32_t)16) +

	if (color & 0xFF000000)
	{
		pixels[pixel_index * 3] = ((color & 0x00FF00) >> 8) * ((color & 0xFF000000) >> 24) / 0xFF;
		pixels[pixel_index * 3 + 1] = ((color & 0xFF0000) >> 16) * ((color & 0xFF000000) >> 24) / 0xFF;
		pixels[pixel_index * 3 + 2] = (color & 0x0000FF) * ((color & 0xFF000000) >> 24) / 0xFF;
	}
	else
	{
		pixels[pixel_index * 3] = (color & 0x00FF00) >> 8;
		pixels[pixel_index * 3 + 1] = (color & 0xFF0000) >> 16;
		pixels[pixel_index * 3 + 2] = color & 0x0000FF;
	}
	
	return (pixels);
}

uint32_t	rainbow_wheel(uint8_t pos)
{
	uint8_t red;
	uint8_t green;
	uint8_t blue;

	if (pos < 85)
	{
		red = pos * 3;
		green = 255 - pos * 3;
		blue = 0;
		
	}
	else if (pos < 170)
	{
		pos -= 85;
		red = 255 - pos * 3;
		green = 0;
		blue = pos * 3;

	}
	else 
	{
		pos -= 170;
		red = 0;
		green = pos * 3;
		blue = 255 - pos * 3;
	}
	return (((int32_t)red << (int32_t)16) + ((int32_t)green << (int32_t)8) + (int32_t)blue);
}

uint32_t	reduce_luminosity(uint32_t color, uint8_t percentage)
{
	return (
			((((color & 0xFF0000) >> (int32_t)16) * percentage / 100) << (int32_t)16) +
			((((color & 0x00FF00) >> (int32_t)8) * percentage / 100) << (int32_t)8) +
			((((color & 0x0000FF) >> (int32_t)0) * percentage / 100) << (int32_t)0)
		);
}


// struct s_gimp_matrix {
//   unsigned int 	 width;
//   unsigned int 	 height;
//   unsigned int 	 bytes_per_pixel; /* 2:RGB16, 3:RGB, 4:RGBA */ 
//   char         	*comment;
//   unsigned char	 pixel_data[8 * 8 * 3 + 1];
// }		t_gimp_matrix;

// t_gimp_matrix gimp_image = {
//   8, 8, 3,
//   "Created with GIMP",
//   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\004\004\004\000\000\000\000\000\000"
//   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\376\061\000\000\000\000\000\000\377\000\000\000\000\000\000"
//   "\000\000\000\000\000\000\000\000\003\003\003\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000"
//   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\374\017\363\000\000\000\000\000\000\000\000\000\000\000\000\374"
//   "\017\363\000\000\000\000\000\000\000\000\000\374\017\363\374\017\363\374\017\363\374\017\363\000\000"
//   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000",
// };

// uint8_t *led_load_gimp(uint8_t luminosity, uint8_t* image)
// {
// 	// uint8_t luminosity = 60;

//  	uint8_t pixels[64] = image;
// 	uint8_t r;
// 	uint8_t g;
// 	uint8_t b;

// 	for (int i = 0; i < 64; i++)
// 	{
// 		r = pixels[i * 3] * luminosity / 100;
// 		g = pixels[i * 3 + 1] * luminosity / 100;
// 		b = pixels[i * 3 + 2] * luminosity / 100;
// 		pixels[i * 3] = g;
// 		pixels[i * 3 + 1] = r;
// 		pixels[i * 3 + 2] = b;
// 	}
// 	return (pixels);
// }

uint8_t	*led_gimp_sword()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
     "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\027\027\030\301\302\306\374\356\345\000\000\000\000\000"
  "\000\000\000\000\000\000\000\027\027\030\302\302\306\375\357\347\206y\234\026\012\000\026\012\000"
  "\000\000\000\027\027\030\302\302\306\375\357\347\205x\234\014\012\020\374\241\000\375\242"
  "\000#\034\030\302\302\306\375\357\347\205x\234\014\012\020\000\000\000\"\022\000\375\242"
  "\017\303\302\305\375\357\347\205x\234\014\012\020\000\000\000\000\000\000\023\004\002\254T\065"
  "\375\242\026\207x\233\034\021\020\000\000\000\000\000\000\000\000\000\251Q\066\252R\067\201+R\375"
  "\242\013\375\242\000\026\012\000\000\000\000\000\000\000}&R~%R\013\001\005\"\021\000\374\241\000\026\012"
  "\000\000\000\000\000\000\000";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}

uint8_t	*led_gimp_purse()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
         "\000\000\000\000\000\000\314h\071\320k:\321k:\202*R\033\017\025\014\013\012\000\000\000\000\000\000\030\011"
  "\001\373\240\002\377\243\002\066\036\004\000\000\000\000\000\000\001\000\000\005\000\001\372\240\000\323m\071"
  "\322k:\203+R\030\003\014\000\000\000\066\036\001\315h\071\375\241\005\323m\071\321j:\321j:"
  "\202*R\027\003\014\315h\071\321j:\321j:\375\241\006\323m\071\321j:\202*R~%S\316h"
  "\071\321j:\321j:\321k:\321j:\203+R~%S~%S\317i:\320j:\321j:\321j:\203+R~%S"
  "~%S~%S\036\007\014}%Q\177&S\177&S\200(S~%S~%S\027\003\014";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}

uint8_t	*led_gimp_bow()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
           "\000\000\000\000\000\000\033\010\003\252Q\066\252R\066\253T\071\251Q\066\013\002\001\000\000\000\023\004\002"
  "\251Q\066~&R/\031E\301\301\305\025\020\017\000\000\000\013\002\001\251Q\066~&S)\017B.\034F\375"
  "\357\346\026\024\023\000\000\000\014\002\001\252Q\066~%S(\016B.\034F\375\357\346\026\024\023"
  "\000\000\000\026\006\002\252Q\066~%S(\016B.\034F\375\357\346\026\024\023\005\001\002\026\006\002\251"
  "Q\066~&S)\017B.\034F\375\357\346\026\024\023\005\001\002\017\004\001\023\004\002\251Q\066~&R\062"
  "\035F\375\357\346\033\025\023\005\001\002\001\000\000\005\001\002\026\004\004\252Q\066\252R\066\254U:"
  "\252Q\066\013\002\001";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}

uint8_t	*led_gimp_potion()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
             "\000\000\000\026\024\023\374\356\345\376\360\347\376\360\347\374\356\345\033\025\023"
  "\000\000\000\000\000\000\000\000\000\035\034\033\302\303\307\302\303\307\035\034\033\000\000\000\000\000\000"
  "\000\000\000\000\000\000\"\037\036\375\357\346\375\357\346\"\037\036\000\000\000\000\000\000\000\000\000\""
  "\037\036\374\356\346\206z\237\206z\237\374\356\346\"\037\036\000\000\000\026\024\023\374"
  "\357\347\067\256\377+\255\376+\255\376\067\256\377\374\357\347\026\024\023\026"
  "\024\023\375\357\347\060\256\377)\255\377)\255\377\060\256\377\375\357\347\026"
  "\024\023\016\016\016\301\302\306\061\255\376-\255\377-\255\377\061\255\376\301\302"
  "\306\016\016\016\000\000\000\027\027\030\300\301\306\301\302\307\301\302\307\301\301"
  "\306\034\030\030\000\000\000";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}

uint8_t	*led_gimp_coin()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
                 "\000\000\000\"\036\001\376\352-\377\354-\377\353-\321o>\032\010\002\000\000\000\"\036\001\375\351"
  "'\323o\071\377\244\002\377\244\002\376\352'\320m\071\032\010\002\375\351'\322n:\376"
  "\244\003\377\352'\323o\071\376\244\003\376\352'\320l:\376\352'\322n:\377\353'"
  "\377\354'\376\353'\322n:\376\353'\320l:\376\352'\322n:\377\353'\377\354'"
  "\376\353'\322n:\376\353'\320l:\375\351'\322n:\376\244\003\377\352'\323o\071"
  "\376\244\003\376\352'\320l:\"\036\001\375\351'\323o\071\377\244\002\377\244\002\376"
  "\352'\320m\071\032\010\002\000\000\000\"\036\001\376\352+\377\354+\377\353+\321n=\032\010"
  "\002\000\000\000";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}

uint8_t	*led_gimp_gem()
{
	uint8_t luminosity = 7;

 	uint8_t *pixels = 
                 "\000\000\000\000\000\000*'\036\375\360\346\066\256\375\020\025\"\000\000\000\000\000\000\000\000\000\"\037\036"
  "\375\357\346\376\361\350\060\256\377)\254\375\001\023\"\000\000\000*'\036\375\357\346"
  "\377\361\350\376\361\350\060\256\377)\255\377)\254\375\020\025\"\375\360\346"
  "\376\361\350\376\361\350\375\360\350\062\255\376+\255\376+\255\376/\254\375"
  "\066\256\375\060\256\377\060\256\377\062\255\376\202w\236\203w\235\203w\235\203"
  "v\235\026\036\")\254\375)\255\377+\255\376\203w\235\203v\234\202u\233\027\015"
  "\021\000\000\000\001\023\")\254\375+\255\376\203w\235\202u\233\014\011\020\000\000\000\000\000\000"
  "\000\000\000\026\036\"\061\255\375\204x\234\027\016\021\000\000\000\000\000\000";
	uint8_t r;
	uint8_t g;
	uint8_t b;

	for (int i = 0; i < 64; i++)
	{
		r = pixels[i * 3] * luminosity / 100;
		g = pixels[i * 3 + 1] * luminosity / 100;
		b = pixels[i * 3 + 2] * luminosity / 100;
		pixels[i * 3] = g;
		pixels[i * 3 + 1] = r;
		pixels[i * 3 + 2] = b;
	}
	return (pixels);
}




void	led_draw_animation(uint16_t pixels_number)
{
	uint8_t pixels[pixels_number * 3];
	uint32_t colors = 0xFF0000;

	const uint8_t *sword = led_gimp_sword();
	const uint8_t *purse = led_gimp_purse();
	const uint8_t *bow = led_gimp_bow();
	const uint8_t *potion = led_gimp_potion();
	const uint8_t *coin = led_gimp_coin();
	const uint8_t *gem = led_gimp_gem();

	serial_putstr("hello\r\n");

	ft_pin_mode(51, FT_OUTPUT);
	ft_pin_mode(3, FT_OUTPUT);


	// uint8_t red = 0;
	for (;;)
	{


		led_send_data(3, sword, 64);
		for (int32_t i = 0; i < 1000000; i++);
		led_send_data(3, purse, 64);
		for (int32_t i = 0; i < 1000000; i++);
		led_send_data(3, bow, 64);
		for (int32_t i = 0; i < 1000000; i++);
		led_send_data(3, potion, 64);
		for (int32_t i = 0; i < 1000000; i++);
		led_send_data(3, coin, 64);
		for (int32_t i = 0; i < 1000000; i++);
		led_send_data(3, gem, 64);
		for (int32_t i = 0; i < 1000000; i++);
	}
}
